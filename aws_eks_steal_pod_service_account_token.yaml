title: Steal Pod Service Account Token - EKS
id: 6e17e565-7372-4d40-9b67-e25aacc022a7
status: disabled
description: "Steals a service account token from a running pod, by executing a command in the pod and reading /var/run/secrets/kubernetes.io/serviceaccount/token\r\n\r\n"
alerts_enabled: false
attack_techniques:
  - T1212
cluster_attributes:
  - source_ips
  - request_uri
  - username
  - user_arns
  - user_session_names
  - user_agent
  - kind
  - stage
display_attributes:
  - source_ips
  - user_arns
  - request_uri
  - raw_request_uri
  - username
lead_summary_template: at {event_time} {user_arns} stole a service account token from a running pod
lead_cluster_summary_template: '{user_arns} stole a service account token from a running pod'
confidence: likely
severity: moderate
detection:
  type: filter
  selections:
    selection1:
      object_ref_resource|eq: pods
      object_ref_subresource|eq: exec
      request_uri|cslike: '%serviceaccount%token&stdout=true%'
event_source_mapping:
  data_type: aws-eks-api-server-audit-logs
  event_attributes:
    - name: kind
      expression: KIND
    - name: object_ref_name
      expression: '"OBJECT_REF":"name"::VARCHAR'
    - name: object_ref_resource
      expression: '"OBJECT_REF":"resource"::VARCHAR'
    - name: object_ref_subresource
      expression: '"OBJECT_REF":"subresource"::VARCHAR'
    - name: raw_request_uri
      expression: '"RAW":"requestURI"::VARCHAR'
    - name: raw_source_i_ps
      expression: '"RAW":"sourceIPs"::VARCHAR'
    - name: request_uri
      expression: REQUEST_URI
    - name: response_status_code
      expression: RESPONSE_STATUS_CODE
    - name: response_status_reason
      expression: RESPONSE_STATUS_REASON
    - name: response_status_status
      expression: RESPONSE_STATUS_STATUS
    - name: source_ips
      expression: SOURCE_IPS
    - name: stage
      expression: STAGE
    - name: stage_timestamp
      expression: STAGE_TIMESTAMP
    - name: user_access_key_ids
      expression: USER_ACCESS_KEY_IDS
    - name: user_arns
      expression: USER_ARNS
    - name: user_canonical_arns
      expression: USER_CANONICAL_ARNS
    - name: user_groups
      expression: USER_GROUPS
    - name: username
      expression: USERNAME
    - name: user_principal_ids
      expression: USER_PRINCIPAL_IDS
    - name: user_session_names
      expression: USER_SESSION_NAMES
    - name: event_time
      expression: request_received_timestamp
    - name: user_agent
      expression: USER_AGENT
