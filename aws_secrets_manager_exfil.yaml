title: Retrieve a High Number of Secrets Manager secrets (IAM user)
id: a6b258cc-deec-4dae-be64-986606d97b70
status: enabled
description: >+
  Retrieves a high number of Secrets Manager secrets, through
  secretsmanager:GetSecretValue.

event_source: cloudtrail_events
alerts_enabled: true
attack_techniques: []
cluster_attributes:
  - user_identity_arn
display_attributes:
  - event_time
  - user_identity_arn
  - user_agent
  - source_ip_address
  - recipient_account_id
  - count_distinct_request_parameters
  - aggregate_error_code
  - aggregate_request_parameters
  - count_event_id
lead_summary_template: '{user_identity_arn} retrieved a high number of Secrets Manager secrets'
lead_cluster_summary_template: |
  {user_identity_arn} retrieved a high number of Secrets Manager secrets
confidence: likely
severity: moderate
detection:
  type: group_by
  selections:
    selection1:
      event_name|cslike: GetSecretValue
      user_identity_arn|cslike: '%@onepeloton.com'
  group_by:
    attributes:
      - user_identity_arn
      - user_agent
      - source_ip_address
      - recipient_account_id
      - user_identity_type
    statistics:
      - count_distinct|request_parameters
      - aggregate|error_code
      - aggregate|request_parameters
      - count|event_id
    timeframe: 10m
  group_selections:
    groupSelection0:
      count_distinct|request_parameters|gte: 10
  state_compat_version: '3'
