title: EKS - Dump All Secrets - API Deployed
id: 8875776-0049-40f7-996f-4e64a9637c35
status: enabled
description: Stratus detection for EKS pod dumping secrets
alerts_enabled: true
alerts_confidence_threshold: possible
severity: major
confidence: possible
lead_summary_template: '{username} peformed a dump of all secrets from a EKS pod'
lead_cluster_summary_template: 'A dump of all secrets from a EKS pod was peformed'
cluster_attributes: 
 - username
detection:
  tables:
    time_tracked_table:
      name: AWS_EKS_API_SERVER_AUDIT_LOGS
  type: raw_sql_auto
  refresh_interval: 10 minutes
  sql: |
    select ID_TIME as start_time, ID_TIME as end_time, ID_TIME as last_event_insertion_time, METADATA$UUID as event_ids, ARRAY_CONSTRUCT(METADATA$DATAFLOW_ID) as DATAFLOW_IDS, ACTOR_EMAIL, EVENT_PARAMETERS:target::varchar as target,EVENT_PARAMETERS:shared_drive_id::varchar as shared_drive_id,EVENT_PARAMETERS:doc_title::varchar as drive_name, EVENT_PARAMETERS:doc_type::varchar as doc_type, EVENT_PARAMETERS:membership_change_type::varchar as membership_change_type,EVENT_PARAMETERS:visibility::varchar as visibility, EVENT_PARAMETERS:added_role::varchar as added_role,EVENT_PARAMETERS:owner_is_shared_drive::varchar as owner_is_shared_drive,EVENT_PARAMETERS:owner_is_team_drive::varchar as owner_is_team_drive,EVENT_PARAMETERS:originating_app_id::varchar as originating_app_id,EVENT_PARAMETERS:owner::varchar as owner,
    from GSUITE_ACTIVITY
    where EVENT_NAME = 'shared_drive_membership_change'
      and membership_change_type = 'add_to_shared_drive' 
      and target not ilike '%onepeloton.com' 