title: EKS - Run an privileged pod - API Deployed
id: 8875776-0049-40f7-996f-4e64a9637g65
status: enabled
description: Stratus detection for EKS pod dumping secrets
alerts_enabled: false
severity: major
confidence: possible
lead_summary_template: '{username} ran a privileged pod'
lead_cluster_summary_template: 'A privileged pod is running on a EKS cluster'
cluster_attributes: 
 - username
detection:
  tables:
    time_tracked_table:
      name: AWS_EKS_API_SERVER_AUDIT_LOGS
  type: raw_sql_auto
  refresh_interval: 10 minutes
  sql: |
    select STAGE_TIMESTAMP as start_time, STAGE_TIMESTAMP as end_time, STAGE_TIMESTAMP as last_event_insertion_time, METADATA$UUID as event_ids, ARRAY_CONSTRUCT(METADATA$DATAFLOW_ID) as DATAFLOW_IDS, STAGE, REQUEST_URI, USERNAME, USER_GROUPS, USER_ACCESS_KEY_IDS, USER_ARNS, USER_SESSION_NAMES, SOURCE_IPS, USER_AGENT, RESPONSE_STATUS_CODE, RESPONSE_OBJECT_KIND, VERB, ANNOTATIONS 
    from RAW.AWS_EKS_API_SERVER_AUDIT_LOGS  
    where RESPONSE_OBJECT_KIND like 'Pod'
      and VERB like 'create'
      and RESPONSE_OBJECT_SPEC like '%"privileged"%true%'
      and STAGE ilike 'ResponseComplete' 
      and RESPONSE_STATUS_CODE like '201'
      and USERNAME not like 'system%serviceaccount%'